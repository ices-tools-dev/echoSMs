rem	B1.5.1 reverberationBCREM 	B1.5.1 REVERBERATIONREM	ASSUME THE SIGNAL IS INCIDENT ON A THIN LAYER AT THE SURFACE.REM 	THE LAYER HAS PARAMETERS HK, DK, AND CK.REM	THE LAYER IS OVER A LAYER D(1) AND C(1).REM	THE IMPULSE RESPONSE OF THE UPWARD TRAVELING SIGNAL IS E(Z)REM	ALL OF THE UPWARD TRAVELING SIGNAL IS ASSUMED TO REVERBERATEREM 	 IN THE LAYER. PROGRAM HAS A MENU FOR CHOICE OF WAVELET REM	PARAMETER, GRAPHING, AND FILING.SCREEN IS 492 BY 300 PIXELS	DIM E(1100),CE(1100),X(1100),W(100)	X0%=20 :Y0%=20: XL%= 480: YL%=280	REM	CLEAN ARRAYS	FOR i = 0 TO 1100	    E(i) = 0	    CE(i) = 0	    X(i) = 0	NEXT i	10	PRINT " Enter t0 = ";:INPUT t0REM	CHOOSE E(Z) FROM REFLECTED SIGNAL CALCULATION.REM	USUALLY ONE WOULD READ A FILE FOR E(Z)	REM	DEFAULT FOR DEMONSTRATION. HK = THICHKNESS,M. DK = DENSITY,REM	CK = SOUND VELOCITY. t0 = SAMPLING INTERVAL	REM 	DEFAULT E(Z) EXAMPLE 	HK = 50:DK = 1:CK = 1500	D(1) = 2:C(1) = 1800REM	CALCULATE TIME STEPS FOR DEPTHS OF REFLECTORS	REM	TOP LAYER	K2 =  INT (2 * HK / (CK * T0) + .5): REM   K2=2*K	R0 = 1: REM  FREE SURFACE VELOCITY REFLECTION	A = D(1) * C(1)	B = DK * CK	R1 = (B - A) / (B + A)	T1 = 2 * D(1) * C(1) / (B + A)	BR =  - R0 * R1REM  ONE GETS A REVERBERATION CONTRIBUTION EVERY K2 TIME STEPSREM 	LOWER LAYERS, FOR SIMPLICITY ASSUME AVERAGE CA=2000 m/s.	CA = 2000	CT=CA * t0	ND1 = INT(2 * 500/CT)	ND2 = INT(2 * 800/CT)	ND3 = INT(2 * 1400/CT)	im = ND3 + 4 * K2	nt = ND3 + 2 * K2	PRINT " max time steps = ";im	IF im  > 1000 GOTO 10		E(0) = 1:E(K2) = R1: E(ND1) = -.294:E(ND2) =.357:  E(ND3) = -.325 REM  	DO THE REVERBERATION IN THE TOP LAYERREM  	USE POLYNOMIAL LONG DIVISION.REM   	CE(Z) = E(Z) * T1 / (1 - R0 * R1 * Z ^ 2 * K)REM    	CE(Z)=E(Z)*T1/(1+BR*Z^K2), SIMPLER NOTATION.REM   	USE THE SPECIAL FORM OF DIVISION FOR (1+BR*Z^K2)REM		TO SPEED THE CALCULATION. 	FOR I = 0 TO K2 - 1	    CE(I) = E(I) * T1	NEXT I		FOR I = K2 TO IM + 2 * K2	    CE(I) = E(I) * T1 - BR * CE(I - K2)	NEXT I REM     END REVERB CALC	100	rem menu	PRINT "enter g  for graphs"	PRINT "         mf to make a file"	PRINT "         c  for convolution with Ricker wavelet"	PRINT "         so to start over	PRINT "         q  to quit"	input q$	if q$ = "g"  goto 2000	if q$ = "mf" goto 3000	if q$ = "c"  goto 1000	if q$ = "so" goto 10	if q$ = "q"  goto 4000	2000 	REM DISPLAY	YS = (YL%-Y0%) / 4        TSC = (XL%-XO%) / (im+1)		print"input amplitude factors for e(n) and ce(n) and x(n)";	input eamp,ceamp,xamp		emp = eamp * YS: cemp = YS * ceamp: xmp = xamp * YS		cls		for n = 0 to im	    T% = int (n * TSC +X0%)	    T1% = int ((n+1) * TSC +X0%)	   	    	    YP% = int (YS - emp * E(n))            YP1% = int ( YS - emp * E(n+1))	    LINE (T%,YP%) - (T1%,YP1%)	next n	for n = 0 to im	    T% = int (n * TSC +X0%)	    T1% = int ((n+1) * TSC +X0%)	   	    	    YP% = int (2*YS - cemp * CE(n))            YP1% = int (2*YS - cemp * CE(n+1))	    LINE (T%,YP%) - (T1%,YP1%)	next n			for n = 0 to im	    T% = int (n * TSC +X0%)	    T1% = int ((n+1) * TSC +X0%)	    YX% = int (3*YS - xmp * X(n))            YX1% = int (3*YS - xmp * X(n+1))	    LINE (T%,YX%) - (T1%,YX1%)	next n	input Q$		GOTO 100	1000	REM CONVOLVE WITH RICKER WAVELETrem	subroutine ricker waveletrem	Wavelet breadth wb is the peak to peak time of the wavelet.rem	The program uses wb to calculate i0. w(i) has 2*i0 duration.   PRINT "Reflection time in top layer =";INT(1000*2*HK/CK)/1000	   PRINT " Input wavelet breadth in s = ";: INPUT wb             	w0= wb/(sqr(6)*t0)       	i0=int(4*w0)      	nw=int(2*i0)      	w2=w0*w0      	print "i0=";i0	      	for i=0 to nw            i2=(i-i0)^2	    W(i)=(1-2*i2/w2)*exp(-i2/w2)      	next i	rem 	convolve CE(z) * W(z) 	for m = 0 to nw	    for n = 0 to nt	        k = m + n		X(k) = X(k) + W(m) * CE(n)	    next n	next m		GOTO 1003000	REM   	FILE MAKERREM   	Number of terms is imREM  	Data is in X(n)	print"give file name":input n$	open n$ for output as #1	write #1, im		FOR n = 0 TO im	    write #1, X(n)	NEXT n		close #1		GOTO 100	4000	END 