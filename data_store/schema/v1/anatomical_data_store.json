{
    "$id": "https://example.com/anatomical.echosms.schema.json",
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "title": "EchoSMs anatomical datastore schema",
    "description": "This schema defines a structure for storing fish and plankton acoustic scattering model data, mainly for input to the echoSMs anatomical datastore.\n\nThe reference version of the schema (formatted as a JSON-schema file) will always be available in the echoSMs github [repository](https://github.com/ices-tools-dev/echoSMs/tree/main/data_store/schema/v1).",
    "type": "object",
    "required": [
        "description",
        "anatomical_category",
        "anatomical_features",
        "date_first_added",
        "date_last_modified",
        "aphiaID",
        "date_collection",
        "date_image",
        "imaging_method",
        "shape_method",
        "dataset_size",
        "dataset_id",
        "specimens"
    ],
    "additionalProperties": false,
    "properties": {
        "dataset_id": {
            "description": "A unique identifier for this dataset, generated by the data storage system.",
            "type": "string"
        },
        "description": {
            "type": "string",
            "description": "A description of the dataset."
        },
        "anatomical_category": {
            "description": "The type of anatomy that this dataset contains.",
            "type": "string",
            "enum": [
                "tissue",
                "organ",
                "organ system",
                "organism",
                "other"
            ]
        },
        "anatomical_features": {
            "description": "The type of anatomical features in this dataset.",
            "type": "array",
            "minItems": 1,
            "items": {
                "type": "string",
                "enum": [
                    "body",
                    "swimbladder",
                    "backbone",
                    "muscle",
                    "other"
                ]
            }
        },
        "date_first_added": {
            "type": "string",
            "format": "date",
            "description": "The date when these metadata were first created, in [RFC9557](https://datatracker.ietf.org/doc/rfc9557) format."
        },
        "date_last_modified": {
            "type": "string",
            "format": "date",
            "description": "The date when these metadata were last modified, in [RFC9557](https://datatracker.ietf.org/doc/rfc9557) format."
        },
        "aphiaID": {
            "type": "integer",
            "minimum": 1,
            "description": "The WoRMS [aphiaID](https://www.marinespecies.org/aphia.php) of the species in this dataset."
        },
        "class": {
            "type": "string",
            "description": "Taxonomical hierarchy level of class that is consistent with WoRMS."
        },
        "order": {
            "description": "Taxonomical hierarchy level of order that is consistent with WoRMS.",
            "type": "string"
        },
        "family": {
            "description": "Taxonomical hierarchy level of family that is consistent with WoRMS.",
            "type": "string"
        },
        "genus": {
            "description": "Taxonomical hierarchy level of genus that is consistent with WoRMS.",
            "type": "string"
        },
        "species": {
            "description": "Taxonomical hierarchy level of species that is consistent with WoRMS.",
            "type": "string"
        },
        "vernacular_name": {
            "description": "A vernacular name for the organism.",
            "type": "string"
        },
        "reference": {
            "description": "A literature reference for the dataset. If available, a DOI or URI is recommended.",
            "type": "string"
        },
        "activity_name": {
            "description": "Name of the data collection activity (if any), such as voyage code, project name, etc.",
            "type": "string"
        },
        "location": {
            "description": "Name or description of the location where organism was collected.",
            "type": "string"
        },
        "latitude": {
            "description": "Latitude of location where organism was collected (decimal degrees).",
            "type": "number",
            "minimum": -90,
            "maximum": 90
        },
        "longitude": {
            "description": "Longitude of location where organism was collected (decimal degrees).",
            "type": "number",
            "minimum": -180,
            "maximum": 180
        },
        "depth": {
            "description": "Depth below surface of organism collection location (m).",
            "type": "number",
            "minimum": 0
        },
        "date_collection": {
            "description": "The date or date range when the dataset was collected, in [RFC9557](https://datatracker.ietf.org/doc/rfc9557) format.",
            "type": "string",
            "format": "date"
        },
        "date_image": {
            "description": "The date when the dataset was imaged, in [RFC9557](https://datatracker.ietf.org/doc/rfc9557) format.",
            "type": "string",
            "format": "date"
        },
        "investigators": {
            "description": "Names or identifying descriptions of persons or organisations that created this dataset.",
            "type": "array",
            "items": {
                "type": "string"
            }
        },
        "data_collection_description": {
            "description": "Description of data collection details.",
            "type": "string"
        },
        "note": {
            "description": "Explanatory notes about the shape data.",
            "type": "string"
        },
        "imaging_method": {
            "description": "Method used to obtain the raw image data.",
            "type": "string",
            "enum": [
                "radiograph",
                "CT",
                "MRI",
                "photograph",
                "3D scanner",
                "unknown",
                "other",
                "not applicable"
            ]
        },
        "shape_method": {
            "description": "Method used to obtain the specimen shape.",
            "type": "string",
            "enum": [
                "manual outline of image(s)",
                "automated outline of images(s)",
                "3D scan of object",
                "not applicable",
                "unknown",
                "other"
            ]
        },
        "shape_method_processing": {
            "description": "Description of processing used to convert raw images into shapes, including any manipulation of image data (for example, smoothing, edge enhancement, rotation, etc).",
            "type": "string"
        },
        "model_type": {
            "description": "Original scattering model type.",
            "type": "string",
            "enum": [
                "KRM",
                "KA",
                "DWBA",
                "PTDWBA",
                "FEM",
                "BEM",
                "MFS",
                "unknown",
                "other"
            ]
        },
        "sound_speed_method": {
            "description": "Method used to obtain sound speed in the feature.",
            "type": "string",
            "enum": [
                "density to sound speed relationship",
                "time-of-flight",
                "literature",
                "unknown",
                "other"
            ]
        },
        "mass_density_method": {
            "description": "Method used to obtain density in the feature.",
            "type": "string",
            "enum": [
                "CT density",
                "liquid displacement",
                "literature",
                "unknown",
                "other"
            ]
        },
        "dataset_size": {
            "description": "Size of the entire dataset (including raw data) (MiB). Generated by the data store server.",
            "type": "number",
            "minimum": 0
        },
        "specimens": {
            "description": "Specimen data.",
            "type": "array",
            "minItems": 1,
            "items": {
                "type": "object",
                "required": [
                    "specimen_id",
                    "specimen_condition",
                    "shapes",
                    "length",
                    "length_type",
                    "shape_type"
                ],
                "additionalProperties": false,
                "properties": {
                    "specimen_id": {
                        "description": "A name that uniquely identifies each specimen in a dataset.",
                        "type": "string"
                    },
                    "specimen_condition": {
                        "description": "Condition of the specimen when it was imaged.",
                        "type": "string",
                        "enum": [
                            "fresh",
                            "frozen",
                            "thawed",
                            "unknown",
                            "other"
                        ]
                    },
                    "length": {
                        "description": "Length of the specimen (m).",
                        "type": "number",
                        "minimum": 0
                    },
                    "weight": {
                        "description": "Weight of the specimen (kg).",
                        "type": "number",
                        "minimum": 0
                    },
                    "sex": {
                        "description": "Sex of specimen",
                        "type": "string",
                        "enum": [
                            "female",
                            "male",
                            "immature",
                            "unknown"
                        ]
                    },
                    "length_type": {
                        "description": "Type of length measurement.",
                        "type": "string",
                        "enum": [
                            "total length",
                            "fork length",
                            "standard length",
                            "lower jaw fork length",
                            "total width",
                            "carapace length",
                            "curved fork length",
                            "disc width",
                            "stretched total length",
                            "CCAMLR krill - front of eye to tip of telson",
                            "unknown",
                            "other"
                        ]
                    },
                    "shape_type": {
                        "description": "Type of shape data used for this specimen.",
                        "type": "string",
                        "enum": [
                            "outline",
                            "surface",
                            "voxels",
                            "categorised voxels"
                        ]
                    },
                    "shapes": {
                        "description": "Shape data.",
                        "type": "array",
                        "minItems": 1,
                        "items": {
                            "type": "object",
                            "required": [
                                "name"
                            ],
                            "properties": {
                                "name": {
                                    "description": "Name of the shape, e.g., 'body', 'swimbladder', 'bone', 'inclusion', etc.",
                                    "type": "string"
                                }
                            },
                            "unevaluatedProperties": false,
                            "oneOf": [
                                {
                                    "required": [
                                        "x",
                                        "y",
                                        "z",
                                        "height",
                                        "width",
                                        "boundary"
                                    ],
                                    "properties": {
                                        "shape_type": {
                                            "const": "outline"
                                        },
                                        "x": {
                                            "description": "x-coordinate of shape centreline (m).",
                                            "type": "array",
                                            "minItems": 1,
                                            "items": {
                                                "type": "number"
                                            }
                                        },
                                        "y": {
                                            "description": "y-coordinate of shape centreline (m).",
                                            "type": "array",
                                            "minItems": 1,
                                            "items": {
                                                "type": "number"
                                            }
                                        },
                                        "z": {
                                            "description": "z-coordinate of shape centreline (m).",
                                            "type": "array",
                                            "minItems": 1,
                                            "items": {
                                                "type": "number"
                                            }
                                        },
                                        "height": {
                                            "description": "Height of the shape at each centreline point (m).",
                                            "type": "array",
                                            "minItems": 1,
                                            "items": {
                                                "type": "number",
                                                "minimum": 0
                                            }
                                        },
                                        "width": {
                                            "description": "Width of the shape at each centreline point (m).",
                                            "type": "array",
                                            "minItems": 1,
                                            "items": {
                                                "type": "number",
                                                "minimum": 0
                                            }
                                        },
                                        "mass_density": {
                                            "description": "Mass density of shape (kg/m³).",
                                            "type": "array",
                                            "minItems": 1,
                                            "items": {
                                                "type": "number",
                                                "minimum": 0
                                            }
                                        },
                                        "sound_speed_compressional": {
                                            "description": "Compressional sound speed in shape (m/s).",
                                            "type": "array",
                                            "minItems": 1,
                                            "items": {
                                                "type": "number",
                                                "minimum": 0
                                            }
                                        },
                                        "sound_speed_shear": {
                                            "description": "Transversal (shear) sound speed in shape (m/s).",
                                            "type": "array",
                                            "minItems": 1,
                                            "items": {
                                                "type": "number",
                                                "minimum": 0
                                            }
                                        },
                                        "mass_density_ratio": {
                                            "description": "Ratio of mass densities of the shape and the surrounding material or shape.",
                                            "type": "array",
                                            "minItems": 1,
                                            "items": {
                                                "type": "number",
                                                "minimum": 0
                                            }
                                        },
                                        "sound_speed_ratio": {
                                            "description": "Ratio of compressional sound speed of the and the surrounding material or shape.",
                                            "type": "array",
                                            "minItems": 1,
                                            "items": {
                                                "type": "number",
                                                "minimum": 0
                                            }
                                        },
                                        "youngs_modulus": {
                                            "description": "Young's modulus, E, of the shape (Pa).",
                                            "type": "array",
                                            "minItems": 1,
                                            "items": {
                                                "type": "number",
                                                "minimum": 0
                                            }
                                        },
                                        "boundary": {
                                            "$ref": "#/$defs/boundary"
                                        }
                                    }
                                },
                                {
                                    "required": [
                                        "x",
                                        "y",
                                        "z",
                                        "facets_0",
                                        "facets_1",
                                        "facets_2",
                                        "normals_x",
                                        "normals_y",
                                        "normals_z",
                                        "boundary"
                                    ],
                                    "properties": {
                                        "shape_type": {
                                            "const": "surface"
                                        },
                                        "x": {
                                            "description": "x-coordinates of surface nodes (m).",
                                            "type": "array",
                                            "minItems": 1,
                                            "items": {
                                                "type": "number"
                                            }
                                        },
                                        "y": {
                                            "description": "y-coordinates of surface nodes (m).",
                                            "type": "array",
                                            "minItems": 1,
                                            "items": {
                                                "type": "number"
                                            }
                                        },
                                        "z": {
                                            "description": "z-coordinates of surface nodes (m).",
                                            "type": "array",
                                            "minItems": 1,
                                            "items": {
                                                "type": "number"
                                            }
                                        },
                                        "facets_0": {
                                            "description": "Zero-based indices into x, y, and z that define node 0 of a surface triangle.",
                                            "type": "array",
                                            "minItems": 1,
                                            "items": {
                                                "type": "integer",
                                                "minimum": 0
                                            }
                                        },
                                        "facets_1": {
                                            "description": "Zero-based indices into x, y, and z that define node 1 of a surface triangle.",
                                            "type": "array",
                                            "minItems": 1,
                                            "items": {
                                                "type": "integer",
                                                "minimum": 0
                                            }
                                        },
                                        "facets_2": {
                                            "description": "Zero-based indices into x, y, and z that define node 2 of a surface triangle.",
                                            "type": "array",
                                            "minItems": 1,
                                            "items": {
                                                "type": "integer",
                                                "minimum": 0
                                            }
                                        },
                                        "normals_x": {
                                            "description": "x-component of outward-pointing normal vector for each facet.",
                                            "type": "array",
                                            "minItems": 1,
                                            "items": {
                                                "type": "number"
                                            }
                                        },
                                        "normals_y": {
                                            "description": "y-component of outward-pointing normal vector for each facet.",
                                            "type": "array",
                                            "minItems": 1,
                                            "items": {
                                                "type": "number"
                                            }
                                        },
                                        "normals_z": {
                                            "description": "z-component of outward-pointing normal vector for each facet.",
                                            "type": "array",
                                            "minItems": 1,
                                            "items": {
                                                "type": "number"
                                            }
                                        },
                                        "mass_density": {
                                            "description": "Mass density of shape (kg/m³).",
                                            "type": "number",
                                            "minimum": 0
                                        },
                                        "sound_speed_compressional": {
                                            "description": "Compressional sound speed in shape (m/s).",
                                            "type": "number",
                                            "minimum": 0
                                        },
                                        "sound_speed_shear": {
                                            "description": "Transversal (shear) sound speed in shape (m/s).",
                                            "type": "number",
                                            "minimum": 0
                                        },
                                        "mass_density_ratio": {
                                            "description": "Ratio of mass densities of the shape and the surrounding material or shape.",
                                            "type": "number",
                                            "minimum": 0
                                        },
                                        "sound_speed_ratio": {
                                            "description": "Ratio of compressional sound speed of the and the surrounding material or shape.",
                                            "type": "number",
                                            "minimum": 0
                                        },
                                        "youngs_modulus": {
                                            "description": "Young's modulus, E, of the shape (Pa).",
                                            "type": "number",
                                            "minimum": 0
                                        },
                                        "boundary": {
                                            "$ref": "#/$defs/boundary"
                                        }
                                    }
                                },
                                {
                                    "required": [
                                        "voxel_size",
                                        "mass_density",
                                        "sound_speed_compressional"
                                    ],
                                    "properties": {
                                        "shape_type": {
                                            "const": "voxels"
                                        },
                                        "voxel_size": {
                                            "description": "Voxel size, ordered x, y, z (m).",
                                            "type": "array",
                                            "minItems": 3,
                                            "maxItems": 3,
                                            "items": {
                                                "type": "number",
                                                "minimum": 0
                                            }
                                        },
                                        "mass_density": {
                                            "description": "Mass density of voxels (kg/m³).",
                                            "type": "array",
                                            "minItems": 1,
                                            "items": {
                                                "type": "array",
                                                "minItems": 1,
                                                "items": {
                                                    "type": "array",
                                                    "minItems": 1,
                                                    "items": {
                                                        "type": "number",
                                                        "minimum": 0
                                                    }
                                                }
                                            }
                                        },
                                        "sound_speed_compressional": {
                                            "description": "Compressional sound speed of voxels (m/s).",
                                            "type": "array",
                                            "minItems": 1,
                                            "items": {
                                                "type": "array",
                                                "minItems": 1,
                                                "items": {
                                                    "type": "array",
                                                    "minItems": 1,
                                                    "items": {
                                                        "type": "number",
                                                        "minimum": 0
                                                    }
                                                }
                                            }
                                        }
                                    }
                                },
                                {
                                    "required": [
                                        "voxel_size",
                                        "categories",
                                        "mass_density",
                                        "sound_speed_compressional"
                                    ],
                                    "properties": {
                                        "shape_type": {
                                            "const": "categorised voxels"
                                        },
                                        "voxel_size": {
                                            "description": "Voxel size, ordered x, y, z (m).",
                                            "type": "array",
                                            "minItems": 3,
                                            "maxItems": 3,
                                            "items": {
                                                "type": "number",
                                                "minimum": 0
                                            }
                                        },
                                        "categories": {
                                            "description": "Voxel categories",
                                            "type": "array",
                                            "minItems": 1,
                                            "items": {
                                                "type": "array",
                                                "minItems": 1,
                                                "items": {
                                                    "type": "array",
                                                    "minItems": 1,
                                                    "items": {
                                                        "type": "integer"
                                                    }
                                                }
                                            }
                                        },
                                        "mass_density": {
                                            "description": "Mass density of voxels categories (kg/m³).",
                                            "type": "array",
                                            "minItems": 1,
                                            "items": {
                                                "type": "number",
                                                "minimum": 0
                                            }
                                        },
                                        "sound_speed_compressional": {
                                            "description": "Compressional sound speed of voxel categories (m/s).",
                                            "type": "array",
                                            "minItems": 1,
                                            "items": {
                                                "type": "number",
                                                "minimum": 0
                                            }
                                        }
                                    }
                                }
                            ]
                        }
                    }
                }
            }
        }
    },
    "$defs": {
        "boundary": {
            "description": "Type of reflecting boundary for this shape.",
            "type": "string",
            "enum": [
                "hard",
                "soft",
                "fluid"
            ]
        }
    }
}